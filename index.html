<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>WebXR AR â€“ Tap to Place</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  </head>

  <body>
    <button id="enter-ar"
      style="
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 10px;
        border: none;
        background: #1abc9c;
        color: white;
        cursor: pointer;
        z-index: 5;
      ">
      Enter AR Mode
    </button>

    <a-scene
      xrweb
      xrweb-hit-test
      renderer="colorManagement: true;"
      vr-mode-ui="enabled: false"
      embedded
      id="scene"
    >
      <!-- Reticle -->
      <a-entity 
        id="reticle"
        geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.06"
        rotation="-90 0 0"
        material="color: #1abc9c; shader: flat"
        visible="false">
      </a-entity>

      <!-- Camera -->
      <a-camera></a-camera>
    </a-scene>

    <script>
      const enterBtn = document.getElementById("enter-ar");
      const scene = document.querySelector("#scene");
      const reticle = document.querySelector("#reticle");
      let placed = false;

      // ----- ENTER AR MODE -----
      enterBtn.onclick = () => {
        scene.enterVR(); // Opens WebXR AR session
      };

      // ----- TAP TO PLACE -----
      scene.addEventListener("click", (e) => {
        if (!reticle.visible) return;

        if (!placed) {
          const box = document.createElement("a-box");
          box.setAttribute("color", "#4CC3D9");
          box.setAttribute("depth", "0.5");
          box.setAttribute("height", "0.5");
          box.setAttribute("width", "0.5");

          // place at reticle position
          const pos = reticle.getAttribute("position");
          box.setAttribute("position", pos);

          scene.appendChild(box);
          placed = true;
        }
      });

      // ----- SHOW RETICLE WHEN PLANE DETECTED -----
      scene.addEventListener("xr-hit-test-start", () => {
        reticle.setAttribute("visible", true);
      });
    </script>
  </body>
</html>
